<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTI Business Development CRM</title>
  <meta name="theme-color" content="#0b2c4f">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@400;500;700;900&family=PT+Sans:wght@400;700&display=swap"
    rel="stylesheet"
  >
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icons/icon-192.png">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha512-Zcn6bjR/8RZbLEpLIeOwNtzREBAJnUKESxces60Mpoj+2okopSAcSUIUOseddDm0cxnGQzxIR7vJgsLZbdLE3w=="
    crossorigin=""
  >
  <link rel="stylesheet" href="style.css">
  <script>
    window.__HTI_API_BASE__ = localStorage.getItem('hti-api-base') || '/api';
    window.__HTI_AUTH_URL__ = localStorage.getItem('hti-auth-url') || '/auth/login';
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha512-BwHfrr4c9kmRkLw6iXFdzcdWV/PGkVgiIyIWLLlTSXzWQzxuSg4DiQUCpauz/EWjgk5TYQqX/kvn9pG1NpYfqg=="
    crossorigin=""
    defer
  ></script>
</head>
<body>
  <div class="app" data-color-scheme="auto">
    <div class="toast-stack" id="toastStack" role="status" aria-live="polite"></div>
    <div class="auth-banner hidden" id="authBanner" role="alert" aria-live="assertive">
      <div class="auth-banner__info">
        <span class="auth-banner__icon" aria-hidden="true">&#128274;</span>
        <div>
          <p class="auth-banner__title" id="authBannerTitle">Sign in required</p>
          <p class="auth-banner__message" id="authBannerMessage">
            Sign in with your HTI credentials to sync live data from the API.
          </p>
          <p class="auth-banner__status" id="authBannerStatus"></p>
        </div>
      </div>
      <div class="auth-banner__actions">
        <button class="btn btn--primary btn--sm" type="button" onclick="startAuthFlow()">Sign in</button>
        <button class="btn btn--outline btn--sm" type="button" onclick="dismissAuthBanner()">Dismiss</button>
      </div>
    </div>

    <header class="header" role="banner">
      <div class="container">
        <div class="header__top">
          <div class="header__brand">
            <h1>HTI Business Development CRM</h1>
            <p class="header__tagline">HUBZone Technology Initiative &middot; Corporate Partnership Management</p>
          </div>
          <div class="header__tools">
            <button class="btn btn--outline btn--sm" id="themeToggle" type="button">
              <span class="theme-toggle__icon" aria-hidden="true">&#9788;</span>
              <span class="theme-toggle__label">Toggle theme</span>
            </button>
            <button class="btn btn--outline btn--sm" type="button" onclick="resetState()">
              <span aria-hidden="true">&#8635;</span>
              <span>Reset data</span>
            </button>
            <div class="header__updated" id="lastRefreshed" aria-live="polite">Updated just now</div>
          </div>
        </div>

        <div class="header__summary" role="group" aria-label="Organizational credentials">
          <span class="status status--success">BBB A+ Rating</span>
          <span class="status status--info">HUBZone Certified</span>
          <span class="status status--warning">$600K Digital Champion Grant</span>
        </div>

        <div class="header__actions" role="group" aria-label="Quick actions">
          <button class="btn btn--primary" type="button" onclick="openAddLeadModal()">Log New Lead</button>
          <button class="btn btn--secondary" type="button" onclick="openCorporateModal()">Add Corporate Target</button>
          <button class="btn btn--outline" type="button" onclick="generateReport()">Generate Executive Report</button>
        </div>
      </div>
    </header>

    <nav class="nav" aria-label="Primary">
      <div class="container nav__layout">
        <div class="nav__tabs" role="tablist">
          <button class="nav__tab nav__tab--active" data-tab="dashboard" role="tab" aria-selected="true">Overview</button>
          <button class="nav__tab" data-tab="leads" role="tab" aria-selected="false">Lead Desk</button>
          <button class="nav__tab" data-tab="corporate" role="tab" aria-selected="false">Pipelines</button>
          <button class="nav__tab" data-tab="reports" role="tab" aria-selected="false">Reports</button>
          <button class="nav__tab" data-tab="settings" role="tab" aria-selected="false">Settings</button>
        </div>
        <div class="nav__overflow">
          <button
            class="nav__more"
            id="navMoreToggle"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="navOverflowMenu"
          >
            More
            <span class="nav__more-icon" aria-hidden="true">&#9662;</span>
          </button>
          <div class="nav__overflow-menu" id="navOverflowMenu" hidden>
            <p class="nav__overflow-title" id="navOverflowTitle">Additional workspaces</p>
            <div class="nav__overflow-list" role="tablist" aria-labelledby="navOverflowTitle">
              <button class="nav__tab" data-tab="dataHub" role="tab" aria-selected="false">CRM Data Hub</button>
              <button class="nav__tab" data-tab="automation" role="tab" aria-selected="false">Automation Studio</button>
              <button class="nav__tab" data-tab="map" role="tab" aria-selected="false">Field Ops Map</button>
              <button class="nav__tab" data-tab="grants" role="tab" aria-selected="false">Grant Compliance</button>
              <button class="nav__tab" data-tab="admin" role="tab" aria-selected="false">Operations Console</button>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <main class="main" role="main">
      <div class="container">
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content tab-content--active" aria-labelledby="Dashboard overview">
          <div class="dashboard">
            <header class="section-header">
              <div>
                <h2>Business Development Dashboard</h2>
                <p class="section-subtitle">Realtime view of corporate partnerships, donations pipeline, and grant milestones.</p>
              </div>
              <div class="section-meta">
                <span class="meta-chip">Week of September 22, 2025</span>
                <span class="meta-chip meta-chip--info" id="activeAlerts">0 Open Alerts</span>
                <span class="meta-chip meta-chip--success" id="topPersonaChip" style="display:none">Top Persona: â€”</span>
              </div>
            </header>

            <div class="metrics-grid">
              <article class="metric-card">
                <header>
                  <h3>Active Leads</h3>
                  <button class="metric-cta" type="button" onclick="switchToTab('leads')">View leads</button>
                </header>
                <div class="metric-value" id="activeLead">3</div>
                <p class="metric-label">Corporate opportunities tracked this week</p>
                <div class="metric-trend" id="activeLeadTrend">+1 vs last week</div>
              </article>

              <article class="metric-card">
                <header>
                  <h3>Equipment Pipeline</h3>
                  <button class="metric-cta" type="button" onclick="switchToTab('leads')">Open pipeline</button>
                </header>
                <div class="metric-value" id="equipmentPipeline">425</div>
                <p class="metric-label">Devices available for refurbishment</p>
                <div class="metric-progress">
                  <div class="metric-progress__bar" id="pipelineProgressBar"></div>
                </div>
              </article>

              <article class="metric-card">
                <header>
                  <h3>Grant Progress</h3>
                  <button class="metric-cta" type="button" onclick="switchToTab('grants')">Review milestones</button>
                </header>
                <div class="metric-value" id="grantProgress">33%</div>
                <p class="metric-label">Digital Champion Grant (Aug 2024 - Dec 2026)</p>
                <div class="metric-progress">
                  <div class="metric-progress__bar" id="grantProgressBar"></div>
                </div>
              </article>

              <article class="metric-card">
                <header>
                  <h3>High Priority Targets</h3>
                  <button class="metric-cta" type="button" onclick="switchToTab('corporate')">Pipeline view</button>
                </header>
                <div class="metric-value" id="highPriorityTargets">4</div>
                <p class="metric-label">Organizations in the acceleration lane</p>
                <div class="metric-trend" id="priorityHealth">Healthy mix</div>
              </article>
            </div>

            <section class="snapshot-grid" aria-label="Pipeline highlights">
              <article class="card card--snapshot">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Conversion Snapshot</h3>
                      <p class="section-subtitle">Progress from discovery to committed donations.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="switchToTab('leads')">Pipeline detail</button>
                  </div>
                  <div class="snapshot-metrics" id="conversionSnapshot"></div>
                </div>
              </article>

              <article class="card card--snapshot">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Top Opportunity</h3>
                      <p class="section-subtitle">Highest scoring lead ready for acceleration.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="viewTopLead()">View lead</button>
                  </div>
                  <div class="snapshot-feature" id="topOpportunity"></div>
                </div>
              </article>

              <article class="card card--snapshot">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Persona Mix</h3>
                      <p class="section-subtitle">Segment the pipeline by outreach archetype.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="switchToTab('leads')">Adjust filters</button>
                  </div>
                  <ul class="persona-list" id="personaSnapshot" aria-live="polite"></ul>
                </div>
              </article>
            </section>

            <section class="action-center">
              <article class="card">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Follow-up Queue</h3>
                      <p class="section-subtitle">Upcoming outreach commitments ordered by urgency.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="switchToTab('leads')">Manage leads</button>
                  </div>
                  <ul class="action-list" id="followUpQueue" aria-live="polite"></ul>
                </div>
              </article>
              <article class="card">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Grant Alerts</h3>
                      <p class="section-subtitle">Track looming deliverables and documentation checkpoints.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="switchToTab('grants')">Grant tracker</button>
                  </div>
                  <ul class="action-list" id="grantAlertsList" aria-live="polite"></ul>
                </div>
              </article>
              <article class="card">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Ingestion History</h3>
                      <p class="section-subtitle">Most recent automations and manual syncs.</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="refreshFromApi()">Refresh</button>
                  </div>
                  <ul class="action-list" id="syncLogList" aria-live="polite"></ul>
                </div>
              </article>
            </section>

            <section class="insights">
              <div class="insights__grid">
                <article class="card">
                  <div class="card__body">
                    <h3>Lead Sources Performance</h3>
                    <div class="chart-frame">
                      <canvas id="leadSourceChart" aria-label="Lead source performance chart"></canvas>
                    </div>
                  </div>
                </article>
                <article class="card">
                  <div class="card__body">
                    <h3>Equipment Distribution</h3>
                    <div class="chart-frame">
                      <canvas id="equipmentChart" aria-label="Equipment mix chart"></canvas>
                    </div>
                  </div>
                </article>
                <article class="card">
                  <div class="card__body">
                    <h3>Grant Roadmap</h3>
                    <ul class="roadmap" id="grantRoadmap"></ul>
                  </div>
                </article>
              </div>
            </section>

            <section class="dashboard-activities">
              <div class="card">
                <div class="card__body">
                  <div class="card__header">
                    <div>
                      <h3>Recent Activities</h3>
                      <p class="section-subtitle">Captured automatically from outreach logs</p>
                    </div>
                    <button class="btn btn--outline btn--sm" type="button" onclick="logSampleActivity()">Log demo activity</button>
                  </div>
                  <div class="activity-list" id="activityList"></div>
                </div>
              </div>
            </section>
          </div>
        </section>

        <!-- Corporate Pipeline Tab -->
        <section id="corporate" class="tab-content" aria-labelledby="Corporate pipeline">
          <header class="section-header">
            <div>
              <h2>Corporate Partnership Pipeline</h2>
              <p class="section-subtitle">Targeted enterprise relationships fueling the refurbishment pipeline.</p>
            </div>
            <div class="section-actions">
              <div class="chip-group" role="group" aria-label="Filter corporate targets">
                <button class="chip chip--active" data-corporate-filter="all">All</button>
                <button class="chip" data-corporate-filter="High">High Priority</button>
                <button class="chip" data-corporate-filter="Medium">Medium Priority</button>
              </div>
              <button class="btn btn--primary" type="button" onclick="openCorporateModal()">Add Target Company</button>
            </div>
          </header>

          <div id="pipelineBoard" role="region" aria-live="polite"></div>
          <div class="pipeline-grid" id="corporateTargets"></div>
        </section>

        <!-- Lead Management Tab -->
        <section id="leads" class="tab-content" aria-labelledby="Lead Management">
          <header class="section-header">
            <div>
              <h2>Lead Management</h2>
              <p class="section-subtitle">Track outreach, vetting, and logistics for donated equipment opportunities.</p>
            </div>
            <div class="section-actions">
              <button class="btn btn--secondary" type="button" onclick="exportLeads()">Export CSV</button>
              <button class="btn btn--primary" type="button" onclick="openAddLeadModal()">Add New Lead</button>
            </div>
          </header>

          <div class="lead-health" id="leadHealth"></div>

          <div class="leads-filters">
            <div class="input-group">
              <label class="form-label" for="searchFilter">Search</label>
              <input class="form-control" id="searchFilter" type="search" placeholder="Search leads by title, company, or contact">
            </div>
            <div class="input-group">
              <label class="form-label" for="statusFilter">Status</label>
              <select id="statusFilter" class="form-control">
                <option value="">All Statuses</option>
                <option value="New">New</option>
                <option value="Researching">Researching</option>
                <option value="Initial Contact">Initial Contact</option>
                <option value="Qualified">Qualified</option>
                <option value="Proposal Sent">Proposal Sent</option>
                <option value="Negotiating">Negotiating</option>
                <option value="Committed">Committed</option>
                <option value="Donated">Donated</option>
              </select>
            </div>
            <div class="input-group">
              <label class="form-label" for="sourceFilter">Source</label>
              <select id="sourceFilter" class="form-control">
                <option value="">All Sources</option>
                <option value="Reddit (r/sysadmin)">Reddit r/sysadmin</option>
                <option value="Reddit (r/ITManagers)">Reddit r/ITManagers</option>
                <option value="LinkedIn">LinkedIn</option>
                <option value="Professional Referral">Professional Referral</option>
                <option value="Facebook Business Groups">Facebook Business Groups</option>
              </select>
            </div>
            <div class="input-group">
              <label class="form-label" for="priorityFilter">Priority</label>
              <select id="priorityFilter" class="form-control">
                <option value="">All Priorities</option>
                <option value="high">High (80+)</option>
                <option value="medium">Medium (60-79)</option>
                <option value="low">Low (&lt;60)</option>
              </select>
            </div>
            <div class="input-group">
              <label class="form-label" for="personaFilter">Persona</label>
              <select id="personaFilter" class="form-control">
                <option value="">All Personas</option>
              </select>
            </div>
            <div class="input-group">
              <label class="form-label" for="sortFilter">Sort</label>
              <select id="sortFilter" class="form-control">
                <option value="priority">Priority (high to low)</option>
                <option value="date">Newest first</option>
                <option value="followUpDate">Closest follow-up</option>
                <option value="quantity">Quantity (high to low)</option>
              </select>
            </div>
          </div>

          <div class="leads-table" id="leadsTable" role="region" aria-live="polite"></div>
        </section>

        <section id="dataHub" class="tab-content" aria-labelledby="Unified CRM data hub">
          <header class="section-header">
            <div>
              <h2>Unified CRM Data Hub</h2>
              <p class="section-subtitle">Household, contact, and organization rollups with dedupe intelligence.</p>
            </div>
            <div class="section-actions">
              <div class="input-group">
                <label class="form-label" for="dataHubSearch">Search</label>
                <input class="form-control" id="dataHubSearch" type="search" placeholder="Search contacts, companies, or households">
              </div>
            </div>
          </header>

          <div class="data-hub" id="dataHubContainer">
            <aside class="data-hub__list" id="entityList" role="navigation" aria-label="CRM records"></aside>
            <div class="data-hub__detail" id="entityDetail">
              <div class="empty-state">
                <h3>Select a record</h3>
                <p>Choose a contact or company to review linked leads, automations, and grant milestones.</p>
              </div>
            </div>
          </div>

          <section class="card card--inline" id="dedupePanel">
            <div class="card__body">
              <div class="card__header">
                <div>
                  <h3>Potential Duplicates</h3>
                  <p class="section-subtitle">Flagged by normalized email and household matching.</p>
                </div>
                <button class="btn btn--outline btn--sm" type="button" onclick="refreshDedupes()">Refresh</button>
              </div>
              <div class="dedupe-list" id="dedupeList" aria-live="polite"></div>
            </div>
          </section>
        </section>

        <section id="automation" class="tab-content" aria-labelledby="Automation Studio">
          <header class="section-header">
            <div>
              <h2>Automation Studio</h2>
              <p class="section-subtitle">Design follow-up cadences, grant alerts, and reminder flows that run while the team is on the road.</p>
            </div>
          </header>

          <div class="automation-grid">
            <section class="card">
              <div class="card__body">
                <h3>Build Automation</h3>
                <form id="automationForm" class="form-grid automation-form">
                  <div class="form-group">
                    <label class="form-label" for="automationName">Automation Name</label>
                    <input class="form-control" id="automationName" type="text" placeholder="Example: Proposal follow-up" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="automationPipeline">Pipeline</label>
                    <select class="form-control" id="automationPipeline"></select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="automationStage">Trigger Stage</label>
                    <select class="form-control" id="automationStage"></select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="automationFollowupDays">Schedule follow-up (days)</label>
                    <input class="form-control" id="automationFollowupDays" type="number" min="1" max="60" value="3">
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="automationPriority">Minimum priority</label>
                    <input class="form-control" id="automationPriority" type="number" min="0" max="100" value="70">
                  </div>
                  <div class="form-group form-group--full">
                    <label class="form-label" for="automationNotes">Action notes</label>
                    <textarea class="form-control" id="automationNotes" rows="2" placeholder="Remind outreach lead to send grant one-pager."></textarea>
                  </div>
                  <div class="form-actions form-group--full">
                    <button class="btn btn--primary" type="submit">Save Automation</button>
                  </div>
                </form>
              </div>
            </section>

            <section class="card">
              <div class="card__body">
                <div class="card__header">
                  <div>
                    <h3>Active Automations</h3>
                    <p class="section-subtitle">Live flows monitoring pipeline events.</p>
                  </div>
                  <button class="btn btn--outline btn--sm" type="button" onclick="refreshAutomations()">Refresh</button>
                </div>
                <div id="automationList" class="automation-list" aria-live="polite"></div>
              </div>
            </section>

            <section class="card">
              <div class="card__body">
                <div class="card__header">
                  <div>
                    <h3>Follow-up Queue</h3>
                    <p class="section-subtitle">Actions created by automations and manual tasks.</p>
                  </div>
                  <button class="btn btn--outline btn--sm" type="button" onclick="refreshTasks()">Refresh</button>
                </div>
                <div id="taskQueue" class="task-queue" aria-live="polite"></div>
              </div>
            </section>
          </div>
        </section>

        <section id="map" class="tab-content" aria-labelledby="Field operations map">
          <header class="section-header">
            <div>
              <h2>Field Operations Map</h2>
              <p class="section-subtitle">Visualize pickups, drop-offs, and routing windows across HUBZone territories.</p>
            </div>
            <div class="section-actions">
              <button class="btn btn--secondary" type="button" onclick="refreshMap()">Refresh map</button>
            </div>
          </header>

          <div class="map-layout">
            <div id="mapView" class="map-view" role="application" aria-label="Lead location map"></div>
            <aside class="map-sidebar" id="mapSidebar">
              <div class="map-sidebar__summary" id="mapSummary"></div>
              <div class="map-sidebar__routes" id="routeList"></div>
            </aside>
          </div>
        </section>

        <!-- Grant Compliance Tab -->
        <section id="grants" class="tab-content" aria-labelledby="Grant compliance tracker">
          <header class="section-header">
            <div>
              <h2>Grant Compliance Tracker</h2>
              <p class="section-subtitle">Stay ahead of state reporting requirements and program deliverables.</p>
            </div>
          </header>

          <section class="grant-overview">
            <article class="card">
              <div class="card__body">
                <h3>Grant Summary</h3>
                <dl class="definition-list">
                  <div class="definition-list__row">
                    <dt>Grantor</dt>
                    <dd>NC Department of Information Technology</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Amount</dt>
                    <dd>$600,000</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Term</dt>
                    <dd>August 2024 &ndash; December 2026</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Mission</dt>
                    <dd>Convert donated laptops into Chromebooks for underserved communities</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Impact Goal</dt>
                    <dd>Distribute 2,000+ devices across 15 NC counties</dd>
                  </div>
                </dl>
              </div>
            </article>
            <article class="card">
              <div class="card__body">
                <h3>Compliance Health</h3>
                <ul class="compliance-health" id="complianceHealth"></ul>
              </div>
            </article>
            <article class="card" id="digitalHoursCard">
              <div class="card__body grant-hours">
                <div class="card__header">
                  <div>
                    <h3>Digital Literacy Hours</h3>
                    <p class="section-subtitle">Minimum 170 hours required by the Digital Champion award.</p>
                  </div>
                  <span class="meta-chip" id="digitalHoursPercent">0%</span>
                </div>
                <div class="metric-progress">
                  <div class="metric-progress__track">
                    <div class="metric-progress__bar" id="digitalHoursBar"></div>
                  </div>
                </div>
                <dl class="definition-list grant-hours__meta">
                  <div class="definition-list__row">
                    <dt>Completed</dt>
                    <dd><span id="digitalHoursCompleted">0</span> hrs</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Remaining</dt>
                    <dd><span id="digitalHoursRemaining">0</span> hrs</dd>
                  </div>
                  <div class="definition-list__row">
                    <dt>Updated</dt>
                    <dd id="digitalHoursUpdated">Pending</dd>
                  </div>
                </dl>
              </div>
            </article>
          </section>

          <div class="milestones-grid" id="grantMilestones"></div>
        </section>

        <!-- Reports Tab -->
        <section id="reports" class="tab-content" aria-labelledby="Reports hub">
          <header class="section-header">
            <div>
              <h2>Reporting Hub</h2>
              <p class="section-subtitle">Produce board-ready updates and compliance summaries in seconds.</p>
            </div>
            <div class="section-actions">
              <button class="btn btn--outline" type="button" onclick="generateReport()">Preview Report</button>
              <button class="btn btn--primary" type="button" onclick="downloadReportPDF()">Download PDF</button>
            </div>
          </header>

          <div class="reports-grid">
            <article class="card">
              <div class="card__body">
                <h3>Pipeline Health</h3>
                <p>Highlights target companies, outreach stages, and blockers.</p>
                <button class="btn btn--outline btn--sm" type="button" onclick="generateReport('pipeline')">Generate</button>
              </div>
            </article>
            <article class="card">
              <div class="card__body">
                <h3>Lead Source Analysis</h3>
                <p>Compare volume and velocity by acquisition channel.</p>
                <button class="btn btn--outline btn--sm" type="button" onclick="generateReport('leadSources')">Generate</button>
              </div>
            </article>
            <article class="card">
              <div class="card__body">
                <h3>Grant Compliance Status</h3>
                <p>Track open tasks, funding consumption, and reporting cadence.</p>
                <button class="btn btn--outline btn--sm" type="button" onclick="generateReport('grant')">Generate</button>
              </div>
            </article>
            <article class="card">
              <div class="card__body">
                <h3>Stakeholder Update</h3>
                <p>Quarterly digest for board briefings and strategic partners.</p>
                <button class="btn btn--outline btn--sm" type="button" onclick="generateReport('stakeholder')">Generate</button>
              </div>
            </article>
          </div>

          <div class="report-preview" id="reportPreview" hidden></div>
        </section>

        <section id="admin" class="tab-content" aria-labelledby="Operations Console">
          <header class="section-header">
            <div>
              <h2>Operations Console</h2>
              <p class="section-subtitle">Monitor ingestion health, connectors, API keys, and embeddable intake forms.</p>
            </div>
            <div class="section-actions">
              <button class="btn btn--secondary" type="button" onclick="refreshOperationsConsole()">Refresh</button>
            </div>
          </header>

          <div class="admin-grid">
            <section class="card">
              <div class="card__body">
                <h3>Ingestion Jobs</h3>
                <div id="ingestionConsole" class="admin-table" aria-live="polite"></div>
              </div>
            </section>
            <section class="card">
              <div class="card__body">
                <h3>Connectors</h3>
                <div id="connectorConsole" class="admin-table" aria-live="polite"></div>
                <button class="btn btn--outline btn--sm" type="button" onclick="openConnectorModal()">Register Connector</button>
              </div>
            </section>
            <section class="card">
              <div class="card__body">
                <h3>API Keys</h3>
                <div id="apiKeyConsole" class="admin-table" aria-live="polite"></div>
                <button class="btn btn--outline btn--sm" type="button" onclick="openApiKeyModal()">Create API Key</button>
              </div>
            </section>
            <section class="card">
              <div class="card__body">
                <h3>Intake Forms</h3>
                <div id="formConsole" class="admin-table" aria-live="polite"></div>
              </div>
            </section>
          </div>
        </section>

        <section id="settings" class="tab-content" aria-labelledby="Settings dashboard">
          <header class="section-header">
            <div>
              <h2>Settings Dashboard</h2>
              <p class="section-subtitle">Control personas, defaults, and feature toggles for HTI-BRIDGE.</p>
            </div>
            <div class="section-actions">
              <button class="btn btn--secondary" type="button" onclick="refreshSettingsFromApi()">Sync settings</button>
              <button class="btn btn--outline" type="button" onclick="resetSettingsToDefaults()">Reset to defaults</button>
            </div>
          </header>

          <div class="settings-grid">
            <section class="card">
              <div class="card__body">
                <h3>Persona Buckets</h3>
                <p class="section-subtitle">Enable or disable personas and adjust weighting for prioritization.</p>
                <form id="personaSettingsForm" class="settings-form" aria-live="polite"></form>
                <div class="form-actions">
                  <button class="btn btn--primary" type="button" onclick="savePersonaSettings()">Save Personas</button>
                </div>
              </div>
            </section>

            <section class="card">
              <div class="card__body">
                <h3>Assignment &amp; Features</h3>
                <form id="preferencesForm" class="settings-form">
                  <div class="form-group">
                    <label class="form-label" for="defaultOwnerSelect">Default Lead Owner</label>
                    <select id="defaultOwnerSelect" class="form-control">
                      <option value="hti-admin">HTI Admin</option>
                      <option value="hti-outreach">Outreach Lead</option>
                      <option value="hti-fellow">HUBZone Fellow</option>
                    </select>
                  </div>
                  <label class="checkbox">
                    <input type="checkbox" id="toggleMap">
                    <span>Enable field ops map</span>
                  </label>
                  <label class="checkbox">
                    <input type="checkbox" id="toggleAutomations">
                    <span>Enable automation studio</span>
                  </label>
                  <div class="form-actions">
                    <button class="btn btn--primary" type="button" onclick="savePreferenceSettings()">Save Preferences</button>
                  </div>
                </form>
              </div>
            </section>

            <section class="card">
              <div class="card__body">
                <h3>API Connection</h3>
                <p class="section-subtitle">Override the API base for this browser if the dashboard is hosted separately.</p>
                <form id="apiBaseForm" class="settings-form">
                  <div class="form-group">
                    <label class="form-label" for="apiBaseInput">API Base URL</label>
                    <input class="form-control" id="apiBaseInput" type="url" placeholder="https://api.hti-bridge.example.com">
                  </div>
                  <div class="form-actions">
                    <button class="btn btn--primary" type="button" onclick="saveApiBaseOverride()">Set API Base</button>
                    <button class="btn btn--outline" type="button" onclick="clearApiBaseOverride()">Use default</button>
                  </div>
                </form>
              </div>
            </section>

            <section class="card">
              <div class="card__body">
                <h3>Authentication</h3>
                <p class="section-subtitle">Configure the sign-in link used when live API calls require credentials.</p>
                <form id="authSettingsForm" class="settings-form">
                  <div class="form-group">
                    <label class="form-label" for="authUrlInput">Sign-in URL</label>
                    <input class="form-control" id="authUrlInput" type="url" placeholder="https://hti-bridge.example.com/auth/login">
                  </div>
                  <p class="settings-hint">Use your identity provider, reverse proxy login, or API gateway sign-in endpoint.</p>
                  <div class="form-actions">
                    <button class="btn btn--primary" type="button" onclick="saveAuthSettings()">Save Auth URL</button>
                    <button class="btn btn--outline" type="button" onclick="clearAuthSettings()">Use default</button>
                  </div>
                </form>
              </div>
            </section>
          </div>
        </section>
      </div>
    </main>

    <!-- Drawers and Modals -->
    <aside class="drawer hidden" id="leadDrawer" aria-hidden="true" aria-labelledby="leadDrawerTitle" role="dialog">
      <div class="drawer__content">
        <div class="drawer__header">
          <div>
            <h3 id="leadDrawerTitle">Lead details</h3>
            <p class="drawer__subtitle" id="leadDrawerSubtitle"></p>
          </div>
          <button class="drawer__close" type="button" aria-label="Close lead details" onclick="closeLeadDrawer()">&times;</button>
        </div>
        <div class="drawer__body" id="leadDrawerBody"></div>
        <div class="drawer__footer">
          <button class="btn btn--outline" type="button" onclick="openLeadStatusModalFromDrawer()">Update status</button>
          <button class="btn btn--primary" type="button" onclick="closeLeadDrawer()">Close</button>
        </div>
      </div>
    </aside>

    <div class="modal hidden" id="addLeadModal" role="dialog" aria-modal="true" aria-labelledby="addLeadTitle">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="addLeadTitle">Add New Lead</h3>
          <button class="modal-close" type="button" aria-label="Close" onclick="closeAddLeadModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="addLeadForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="leadTitle">Lead Title</label>
                <input type="text" class="form-control" id="leadTitle" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="leadCompany">Company</label>
                <input type="text" class="form-control" id="leadCompany" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="leadContact">Contact</label>
                <input type="text" class="form-control" id="leadContact" placeholder="Name or handle">
              </div>
              <div class="form-group">
                <label class="form-label" for="leadLocation">Location</label>
                <input type="text" class="form-control" id="leadLocation" placeholder="City, State">
              </div>
              <div class="form-group">
                <label class="form-label" for="leadSource">Source</label>
                <select class="form-control" id="leadSource" required>
                  <option value="">Select Source</option>
                  <option value="Reddit (r/sysadmin)">Reddit r/sysadmin</option>
                  <option value="Reddit (r/ITManagers)">Reddit r/ITManagers</option>
                  <option value="LinkedIn">LinkedIn</option>
                  <option value="Professional Referral">Professional Referral</option>
                  <option value="Facebook Business Groups">Facebook Business Groups</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="leadEquipmentType">Equipment Type</label>
                <select class="form-control" id="leadEquipmentType">
                  <option value="">Select Type</option>
                  <option value="Business Laptops">Business Laptops</option>
                  <option value="Desktop Computers">Desktop Computers</option>
                  <option value="Mixed Equipment">Mixed Equipment</option>
                  <option value="Tablets">Tablets</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="leadQuantity">Estimated Quantity</label>
                <input type="number" class="form-control" id="leadQuantity" min="0" placeholder="Devices">
              </div>
              <div class="form-group">
                <label class="form-label" for="leadFollowUp">Follow-up Date</label>
                <input type="date" class="form-control" id="leadFollowUp">
              </div>
              <div class="form-group form-group--full">
                <label class="form-label" for="leadNotes">Notes</label>
                <textarea class="form-control" id="leadNotes" rows="3"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" type="button" onclick="closeAddLeadModal()">Cancel</button>
          <button class="btn btn--primary" type="button" onclick="addLead()">Add Lead</button>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="leadStatusModal" role="dialog" aria-modal="true" aria-labelledby="leadStatusTitle">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="leadStatusTitle">Update Lead Status</h3>
          <button class="modal-close" type="button" aria-label="Close" onclick="closeLeadStatusModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="leadStatusForm">
            <input type="hidden" id="statusLeadId">
            <div class="form-group">
              <label class="form-label" for="leadStatusSelect">Status</label>
              <select class="form-control" id="leadStatusSelect" required>
                <option value="New">New</option>
                <option value="Researching">Researching</option>
                <option value="Initial Contact">Initial Contact</option>
                <option value="Qualified">Qualified</option>
                <option value="Proposal Sent">Proposal Sent</option>
                <option value="Negotiating">Negotiating</option>
                <option value="Committed">Committed</option>
                <option value="Donated">Donated</option>
                <option value="Not Interested">Not Interested</option>
                <option value="Invalid">Invalid</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="leadPriorityInput">Priority Score</label>
              <input type="number" class="form-control" id="leadPriorityInput" min="0" max="100">
            </div>
            <div class="form-group">
              <label class="form-label" for="leadFollowUpInput">Follow-up Date</label>
              <input type="date" class="form-control" id="leadFollowUpInput">
            </div>
            <div class="form-group">
              <label class="form-label" for="leadNotesInput">Notes</label>
              <textarea class="form-control" id="leadNotesInput" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" type="button" onclick="closeLeadStatusModal()">Cancel</button>
          <button class="btn btn--primary" type="button" onclick="submitLeadStatusForm()">Save</button>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="corporateModal" role="dialog" aria-modal="true" aria-labelledby="corporateModalTitle">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="corporateModalTitle">Add Corporate Target</h3>
          <button class="modal-close" type="button" aria-label="Close" onclick="closeCorporateModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="corporateForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="corporateName">Company</label>
                <input type="text" class="form-control" id="corporateName" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="corporateLocation">Location</label>
                <input type="text" class="form-control" id="corporateLocation" placeholder="City, State">
              </div>
              <div class="form-group">
                <label class="form-label" for="corporateType">Industry</label>
                <input type="text" class="form-control" id="corporateType" placeholder="Technology, Finance, etc.">
              </div>
              <div class="form-group">
                <label class="form-label" for="corporateEmployees">Employee Count</label>
                <input type="text" class="form-control" id="corporateEmployees" placeholder="2500, 5k+, etc.">
              </div>
              <div class="form-group">
                <label class="form-label" for="corporateStatus">Status</label>
                <select class="form-control" id="corporateStatus">
                  <option value="Research">Research</option>
                  <option value="Discovery Call">Discovery Call</option>
                  <option value="Initial Contact">Initial Contact</option>
                  <option value="Proposal Sent">Proposal Sent</option>
                  <option value="Strategic Partner">Strategic Partner</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="corporatePriority">Priority</label>
                <select class="form-control" id="corporatePriority">
                  <option value="High">High</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="Low">Low</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="corporateFocus">Impact Focus</label>
                <input type="text" class="form-control" id="corporateFocus" placeholder="Digital inclusion, workforce, etc.">
              </div>
              <div class="form-group form-group--full">
                <label class="form-label" for="corporateNotes">Notes</label>
                <textarea class="form-control" id="corporateNotes" rows="3"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" type="button" onclick="closeCorporateModal()">Cancel</button>
          <button class="btn btn--primary" type="button" onclick="submitCorporateForm()">Add Company</button>
        </div>
      </div>
    </div>
  </div>

    <div class="modal hidden" id="connectorModal" role="dialog" aria-modal="true" aria-labelledby="connectorModalTitle">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="connectorModalTitle">Register Connector</h3>
          <button class="modal-close" type="button" aria-label="Close" onclick="closeConnectorModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="connectorForm" class="form-grid">
            <div class="form-group">
              <label class="form-label" for="connectorName">Connector Name</label>
              <input class="form-control" id="connectorName" type="text" placeholder="Gmail Outreach" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="connectorType">Type</label>
              <select class="form-control" id="connectorType" required>
                <option value="gmail">Gmail</option>
                <option value="outlook">Outlook</option>
                <option value="csv">CSV Import</option>
                <option value="ics">Calendar (ICS)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="connectorStatus">Status</label>
              <select class="form-control" id="connectorStatus">
                <option value="connected">Connected</option>
                <option value="pending">Pending Auth</option>
                <option value="disabled">Disabled</option>
              </select>
            </div>
            <div class="form-group form-group--full">
              <label class="form-label" for="connectorSettings">Settings / Notes</label>
              <textarea class="form-control" id="connectorSettings" rows="3" placeholder="Scopes, shared mailbox, token metadata"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" type="button" onclick="closeConnectorModal()">Cancel</button>
          <button class="btn btn--primary" type="button" onclick="submitConnectorForm()">Save Connector</button>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="apiKeyModal" role="dialog" aria-modal="true" aria-labelledby="apiKeyModalTitle">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="apiKeyModalTitle">Create API Key</h3>
          <button class="modal-close" type="button" aria-label="Close" onclick="closeApiKeyModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="apiKeyForm" class="form-grid">
            <div class="form-group">
              <label class="form-label" for="apiKeyName">Key Label</label>
              <input class="form-control" id="apiKeyName" type="text" placeholder="Partner Referral Form" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="apiKeyExpiry">Expires On</label>
              <input class="form-control" id="apiKeyExpiry" type="date">
            </div>
            <fieldset class="form-group form-group--full">
              <legend class="form-label">Scopes</legend>
              <div class="checkbox-grid">
                <label class="checkbox">
                  <input type="checkbox" value="leads:write" checked>
                  <span>Submit Leads</span>
                </label>
                <label class="checkbox">
                  <input type="checkbox" value="forms:submit" checked>
                  <span>Submit Forms</span>
                </label>
                <label class="checkbox">
                  <input type="checkbox" value="leads:read">
                  <span>Read Leads</span>
                </label>
              </div>
            </fieldset>
            <div class="form-group form-group--full">
              <label class="form-label" for="apiKeyOrigins">Allowed Origins (comma separated)</label>
              <input class="form-control" id="apiKeyOrigins" type="text" placeholder="https://partner.hti.org">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" type="button" onclick="closeApiKeyModal()">Cancel</button>
          <button class="btn btn--primary" type="button" onclick="submitApiKeyForm()">Generate Key</button>
        </div>
      </div>
    </div>

  <script type="module" src="web/main.js"></script>
</body>
</html>
